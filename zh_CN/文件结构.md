# 文件结构

## 构成 [!失效，新版增加了新的段]

CMS 主要由四个段组成：

- .datas 段 ： 存放各种数据
- .idents 段 ： 对于各种标识符进行声明。
- .imports 段 ： 对于库的导入。
- .code 段 ： 主要的运行代码。

给定一个 Chill 语言的源程序：

```
(let a "Hello ")
(let b "World ")
(println (+ a b))

(dim c Int)
(set c 0x100)
(println c)

(define d (+ 5 7))
(println d)

(defunc f [str]
  (return str))
(println (f "call f."))

(module Math
  (define pi 3.14)
)
(println Math.pi)
```

经过 ICM 会生成如下 CMS 代码：

```
;; Main.cms

.module Math:
        .data pi 3.14

.imports:
        .import Chill
        .using  Chill#Core
        .alias  println Console#println

.exports:
        .module Math
        .func   main
        .func   f

.datas:
        .string #1   "Hello "
        .string #2   "World!"
        .string #3   "call f."
        
.codes:
        .entry  main

f:
        .mode automatic
        .arg 1
        mov  %res, %1
        ret

main:
        .mode multiply
        .dyvarb 3                  ; a b _temp
        .stvarb %4, Int            ; (dim c Int)

        loadt %1, #1, String       ; (let a "Hello ")
        loadt %2, #2, String       ; (let b "World ")
        call  %3, String#+, %1, %2 ; (+ a b) -> %3
        call  %0, println, %3      ; (println %3)

        load  %4, 0x100            ; (set c 0x100)
        call  %0, println, %4      ; (println c)

        loadt %3, 12, Int          ; (define d (+ 5 7))
        call  %0, println, %3      ; (println d)

        loadt %3, #4, String       ; "call f" -> %3
        call  %3, f, %3            ; (f %3) -> %3
        call  %0, println, %3      ; (println %3)

        call  %0, println, Math#pi ; (println Math.pi)
        ret
```
